{"ast":null,"code":"import React,{createContext,useContext,useEffect,useState}from'react';import{io}from'socket.io-client';import{useAuth}from'./AuthContext';import{jsx as _jsx}from\"react/jsx-runtime\";const SocketContext=/*#__PURE__*/createContext();export const SocketProvider=_ref=>{let{children}=_ref;const[socket,setSocket]=useState(null);const[isConnected,setIsConnected]=useState(false);const{user,isAuthenticated}=useAuth();useEffect(()=>{if(isAuthenticated&&user){var _process$env$REACT_AP;// Connect to socket server\nconst socketInstance=io(((_process$env$REACT_AP=process.env.REACT_APP_API_URL)===null||_process$env$REACT_AP===void 0?void 0:_process$env$REACT_AP.replace('/api',''))||'http://localhost:5000',{transports:['websocket','polling'],reconnection:true,reconnectionDelay:1000,reconnectionAttempts:5});socketInstance.on('connect',()=>{console.log('Socket connected:',socketInstance.id);setIsConnected(true);// Join user's room for personalized notifications\nif(user._id){socketInstance.emit('join-room',user._id);}});socketInstance.on('disconnect',()=>{console.log('Socket disconnected');setIsConnected(false);});socketInstance.on('connect_error',error=>{console.error('Socket connection error:',error);setIsConnected(false);});setSocket(socketInstance);return()=>{socketInstance.disconnect();};}else{// Disconnect if user logs out\nif(socket){socket.disconnect();setSocket(null);setIsConnected(false);}}},[isAuthenticated,user]);// Listen for notifications\nuseEffect(()=>{if(socket&&user){const handleNotification=notification=>{// This will be handled by components that need real-time notifications\nconsole.log('New notification:',notification);};socket.on('notification',handleNotification);socket.on('bus-location-update',data=>{console.log('Bus location update:',data);});socket.on('schedule-change',data=>{console.log('Schedule change:',data);});return()=>{socket.off('notification',handleNotification);socket.off('bus-location-update');socket.off('schedule-change');};}},[socket,user]);const emit=(event,data)=>{if(socket&&isConnected){socket.emit(event,data);}};const value={socket,isConnected,emit};return/*#__PURE__*/_jsx(SocketContext.Provider,{value:value,children:children});};export const useSocket=()=>{const context=useContext(SocketContext);if(!context){throw new Error('useSocket must be used within a SocketProvider');}return context;};export default SocketContext;","map":{"version":3,"names":["React","createContext","useContext","useEffect","useState","io","useAuth","jsx","_jsx","SocketContext","SocketProvider","_ref","children","socket","setSocket","isConnected","setIsConnected","user","isAuthenticated","_process$env$REACT_AP","socketInstance","process","env","REACT_APP_API_URL","replace","transports","reconnection","reconnectionDelay","reconnectionAttempts","on","console","log","id","_id","emit","error","disconnect","handleNotification","notification","data","off","event","value","Provider","useSocket","context","Error"],"sources":["C:/Users/Giriraj singh/Desktop/vhh/client/src/contexts/SocketContext.js"],"sourcesContent":["import React, { createContext, useContext, useEffect, useState } from 'react';\r\nimport { io } from 'socket.io-client';\r\nimport { useAuth } from './AuthContext';\r\n\r\nconst SocketContext = createContext();\r\n\r\nexport const SocketProvider = ({ children }) => {\r\n  const [socket, setSocket] = useState(null);\r\n  const [isConnected, setIsConnected] = useState(false);\r\n  const { user, isAuthenticated } = useAuth();\r\n\r\n  useEffect(() => {\r\n    if (isAuthenticated && user) {\r\n      // Connect to socket server\r\n      const socketInstance = io(process.env.REACT_APP_API_URL?.replace('/api', '') || 'http://localhost:5000', {\r\n        transports: ['websocket', 'polling'],\r\n        reconnection: true,\r\n        reconnectionDelay: 1000,\r\n        reconnectionAttempts: 5,\r\n      });\r\n\r\n      socketInstance.on('connect', () => {\r\n        console.log('Socket connected:', socketInstance.id);\r\n        setIsConnected(true);\r\n        \r\n        // Join user's room for personalized notifications\r\n        if (user._id) {\r\n          socketInstance.emit('join-room', user._id);\r\n        }\r\n      });\r\n\r\n      socketInstance.on('disconnect', () => {\r\n        console.log('Socket disconnected');\r\n        setIsConnected(false);\r\n      });\r\n\r\n      socketInstance.on('connect_error', (error) => {\r\n        console.error('Socket connection error:', error);\r\n        setIsConnected(false);\r\n      });\r\n\r\n      setSocket(socketInstance);\r\n\r\n      return () => {\r\n        socketInstance.disconnect();\r\n      };\r\n    } else {\r\n      // Disconnect if user logs out\r\n      if (socket) {\r\n        socket.disconnect();\r\n        setSocket(null);\r\n        setIsConnected(false);\r\n      }\r\n    }\r\n  }, [isAuthenticated, user]);\r\n\r\n  // Listen for notifications\r\n  useEffect(() => {\r\n    if (socket && user) {\r\n      const handleNotification = (notification) => {\r\n        // This will be handled by components that need real-time notifications\r\n        console.log('New notification:', notification);\r\n      };\r\n\r\n      socket.on('notification', handleNotification);\r\n      socket.on('bus-location-update', (data) => {\r\n        console.log('Bus location update:', data);\r\n      });\r\n      socket.on('schedule-change', (data) => {\r\n        console.log('Schedule change:', data);\r\n      });\r\n\r\n      return () => {\r\n        socket.off('notification', handleNotification);\r\n        socket.off('bus-location-update');\r\n        socket.off('schedule-change');\r\n      };\r\n    }\r\n  }, [socket, user]);\r\n\r\n  const emit = (event, data) => {\r\n    if (socket && isConnected) {\r\n      socket.emit(event, data);\r\n    }\r\n  };\r\n\r\n  const value = {\r\n    socket,\r\n    isConnected,\r\n    emit,\r\n  };\r\n\r\n  return (\r\n    <SocketContext.Provider value={value}>\r\n      {children}\r\n    </SocketContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useSocket = () => {\r\n  const context = useContext(SocketContext);\r\n  if (!context) {\r\n    throw new Error('useSocket must be used within a SocketProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\nexport default SocketContext;\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}